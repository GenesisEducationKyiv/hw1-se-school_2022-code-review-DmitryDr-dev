# GSES2 BTC application

## Вимоги

### Основні вимоги

Сервіс повинен дозволити:

- дізнатись поточний курс біткоіну (BTC) у гривні (UAH)
- підписати емейл на отримання інформації по зміні курсу
- запит, який відправить всім підписаним користувачам актуальний курс

### Додаткові вимоги

- Сервіс повинен відповідати поданому [API](https://github.com/AndriiPopovych/gses/blob/main/gses2swagger.yaml)
- У якості бази даних необхідно використовувати файлову систему
- В репозиторії повинен бути Dockerfile, який дозволяє запустити систему в Docker

## Опис додатку

Для виконання даного завдання фреймворку було обрано поєднання Nest.js + TypeScript. З метою поліпшення підтримки та розробки додатку я спробував детально продумати його архітектуру. У побудові архітектури я керувався принципами SOLID та DRY. Переді мною стояла мета створити незалежні сервіси, які можна було б максимально легко розширювати та використовувати повторно. Так я намагався зменшити зв'зність (coupling), тому поділив модулі за сферами їх відповідальності

Насамперед, я виділив для себе наступні складові майбутнього додатку:

1. Основні Модулі

- **Rate** - модуль для отримання поточного курсу валют
- **Subscription** - модуль, що дозволяє додати email користувача до бази даних (далі БД) та зробити масове розсилання за запитом

2. Допоміжні модулі

- **Exception Filter** - цей модуль відповідає за кастомне оброблення exceptions та відправки відповіді користувачу
- **Validation Pipe** - цей модуль відповідає за перевірку вхідних даних відповідно до заданого DTO (Data Transfer Object)

3. Модуль бази даних

- **Local Database**
- **Database Binary Tree**
- **Database Storage**

4. Додаткові модулі

- **API Module** - для отримання інформації про курс валют з third party сервісу
- **Mail Module** - для розсилання email за заданим шаблоном

Нижче я б хотів детальніше зупинитись на деяких рішеннях при створенні цього веб-додатку

## Основні модулі

Кожен з основних модулів побудований за принципом:

`Incoming Data -> Validation -> Controller <-> Service <-> Other Services`

- _Incoming Data_ - потік вхідних даних
- _Validation Pipe_ - pipe для валідації вхідних даних згідно з нашим DTO. На прикладі нашого додатку ми валідуємо вхідний email на предмет правильного формату та типу даних. Для валідації використовуються бібліотеки _class-validator_ та _class-transformer_
- _Controller_ - використовується для оброблення запитів та передачі для подальшої обробки сервісам. Після отримання даних від сервісу робить відповідь клієнту: у разі успіху `HttpStatus.OK` або відправляє `exception` у разі помилки.
- _Service_ - використовується для бізнес- логіки та взаємодії з іншими сервісами
- _Other Services_ - інші сервіси (наприклад, Mail Service, Exchange API Service, Local Database)

## Database Module

Під час реалізації цього модуля було прийняти рішення відмовитися від зберігання даних у вигляді масиву, або простого списку. Оскільки складність пошуку необхідного нам елементу буде складати `O(n)`, то у випадку великої кількості елементів у БД це буде займати значний час.
Збереження даних у файлі було вирішено зберігати у вигляді бінарного дерева пошуку. Складність пошуку, додавання та видалення елементів у цьому варіанті становить `O(log n)` у найкращому випадку і `O(n)`, якщо дерево не збалансоване.

Тому модуль `Database Module` складається з трьох модулів:

- **Local Database** - головний модуль - інформаційний експерт.
  - Він координує створення файлів бази даних, зчитування файлів, запису нових елементів у дерево та інше.
  - Під час реалізації цього модуля я виходив із того, що для нашого бекенд додатку дуже важливим є використання пам'яті, тому усі дерева одразу записуються у файл і не зберігаються у пам'яті
  - Також під час ініціалізації додатку відбувається перевірка чи існують необхідні файли і якщо їх нема, вони будуть створені автоматично
- **Database Binary Tree** - представляє собою модуль для роботи з деревом. Дозволяє
  - створити дерево
  - додати елементи
  - обійти дерево і зібрати усі елементи у вигляді масиву
- **Database Storage** - модуль, що відповідає за зчитування, запис даних у файли
